{% extends "layouts/base.html" %}
{% block title %}Registrar Estudios{% endblock %}

{% block content %}
<div class="container">
    <h2 class="text-center my-4">Registrar Estudios</h2>
    <form method="post" class="shadow p-4 rounded bg-light">
        {% csrf_token %}
        <div class="mb-3">
            <label for="{{ form.paciente_nombre.id_for_label }}" class="form-label">Nombre del Paciente</label>
            {{ form.paciente_nombre }}
        </div>
        <div class="mb-3">
            <label for="{{ form.paciente_dni.id_for_label }}" class="form-label">DNI del Paciente</label>
            {{ form.paciente_dni }}
        </div>
        <div class="mb-3">
            <label for="{{ form.fecha_estudio.id_for_label }}" class="form-label">Fecha del Estudio</label>
            {{ form.fecha_estudio }}
        </div>
        <div class="mb-3">
            <label for="{{ form.estudios.id_for_label }}" class="form-label">Estudios Realizados</label>
            {{ form.estudios }}
            <div id="total-regiones" class="mt-2"></div>
        </div>        
        <button type="submit" class="btn btn-primary w-100">Guardar</button>
    </form>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        console.log("Script cargado correctamente");
        const estudiosField = document.querySelector("#id_estudios");

        if (!estudiosField) {
            console.error("No se encontr√≥ el campo de estudios.");
            return;
        }
        console.log("Campo estudios encontrado:", estudiosField);

        const totalRegionesContainer = document.createElement("p");
        totalRegionesContainer.innerHTML = `<strong>Total de Regiones: 0</strong>`;
        estudiosField.parentNode.appendChild(totalRegionesContainer);

        estudiosField.addEventListener("change", function () {
            let total = 0;

            // Recalcula el total basado en las opciones seleccionadas
            [...estudiosField.options].forEach(option => {
                if (option.selected) {
                    const regiones = parseInt(option.dataset.regiones) || 0;
                    total += regiones;
                }
            });

            // Actualiza el total en la interfaz
            totalRegionesContainer.innerHTML = `<strong>Total de Regiones: ${total}</strong>`;
        });
    });
</script>

{% endblock %}
